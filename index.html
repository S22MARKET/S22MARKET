<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>S22 Market - Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</title>
    <meta name="description" content="Ù…ØªØ¬Ø± S22 Market - Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ø¹Ø±ÙˆØ¶">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <style>
        :root {
            --primary-color: #4f46e5;
            --primary-hover: #4338ca;
            --bg-body: #f1f5f9;
            --bg-card: #ffffff;
            --text-primary: #1e293b;
            --border-color: #e2e8f0;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-primary);
        }

        html {
            scroll-behavior: smooth;
        }

        /* Ø´Ø§Ø´Ø§Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        .small-loader {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: #fff;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ø¸Ù‡ÙˆØ± */
        .fade-in-section {
            animation: fadeIn 0.8s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© ÙˆØ§Ù„Ø·Ø¨Ù‚Ø© Ø§Ù„Ø´ÙØ§ÙØ© */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1100;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }

        .overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .side-bar {
            position: fixed;
            top: 0;
            right: -100%;
            width: 32rem;
            max-width: 90%;
            height: 100vh;
            background-color: var(--bg-card);
            border-left: 1px solid var(--border-color);
            z-index: 1200;
            transition: right 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .side-bar.active {
            right: 0;
        }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙÙ„ÙŠØ© */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--bg-card);
            border-top: 1px solid var(--border-color);
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-around;
            padding: 0.5rem 0;
            z-index: 900;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            color: #64748b;
            text-decoration: none;
            flex-grow: 1;
            padding: 0.25rem 0;
        }

        .nav-item i {
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
        }

        .nav-item.active {
            color: var(--primary-color);
        }

        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Swiper ÙˆØ§Ù„ÙƒØ±ÙˆØª */
        .swiper-container {
            overflow: hidden;
            padding-bottom: 10px;
        }

        .swiper-slide {
            width: auto;
        }

        .carousel-card {
            width: 42vw;
            min-width: 150px;
            max-width: 170px;
            background-color: var(--bg-card);
            border-radius: 0.75rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            border: 1px solid var(--border-color);
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
        }

        .carousel-card-image {
            aspect-ratio: 1 / 1;
            background-size: cover;
            background-position: center;
        }

        .carousel-card-content {
            padding: 0.5rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .carousel-card-title {
            font-size: 0.875rem;
            font-weight: 700;
            line-height: 1.4;
            height: 2.45em;
            overflow: hidden;
            margin-bottom: 0.25rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .offer-carousel-card {
            width: 80vw;
            min-width: 260px;
            max-width: 300px;
            background-color: var(--bg-card);
            border-radius: 0.75rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            border: 1px solid var(--border-color);
            flex-shrink: 0;
        }

        .offer-carousel-image {
            aspect-ratio: 16 / 9;
            background-size: cover;
            background-position: center;
        }

        .offer-carousel-title {
            font-size: 1rem;
            font-weight: 700;
            margin: 0.75rem 0.75rem 0.5rem;
            height: 2.6em;
            line-height: 1.3;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .offer-price {
            color: var(--primary-color);
            font-size: 1.25rem;
            font-weight: 800;
            margin: 0 0.75rem 0.75rem;
        }

        /* Ø§Ù„ØªØ§ÙŠÙ…Ø± */
        .countdown-timer-container {
            background-color: rgba(239, 68, 68, 0.1);
            border-top: 1px solid rgba(239, 68, 68, 0.2);
            padding: 0.5rem 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .countdown-timer {
            direction: ltr;
            font-family: monospace, 'Tajawal', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            color: #dc2626;
            display: flex;
            gap: 0.25rem;
        }

        .countdown-timer>div {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 1.5rem;
        }

        .countdown-timer span {
            font-size: 0.6rem;
            font-weight: 500;
            color: #b91c1c;
        }

        /* Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª ÙˆØ§Ù„Ø²Ø± Ø§Ù„Ø¹Ø§Ø¦Ù… */
        .category-icon-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            color: var(--text-primary);
            font-weight: 600;
            font-size: 0.875rem;
        }

        .category-icon-circle {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background-color: var(--bg-card);
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease;
        }

        .category-icon-item:hover .category-icon-circle {
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .fab {
            position: fixed;
            bottom: 90px;
            left: 20px;
            width: 60px;
            height: 60px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            z-index: 800;
            transition: transform 0.2s;
        }

        .fab:hover {
            transform: scale(1.05);
            background-color: var(--primary-hover);
        }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… */
        #user-menu-dropdown.show {
            display: block;
            animation: slideInUp 0.2s ease-out;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© (Modals) */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s;
            padding: 1rem;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: var(--bg-card);
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            width: 100%;
            max-width: 700px;
            max-height: 95vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            border-radius: 1rem;
        }

        /* Ø§Ù„ØªÙˆØ³Øª (Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª) */
        #toast-container {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1001;
            width: calc(100% - 2rem);
            max-width: 400px;
        }

        .toast {
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            color: white;
            background-color: #10b981;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            animation: slideInUp 0.5s, fadeOut 0.5s 4.5s forwards;
        }

        .toast.error {
            background-color: #ef4444;
        }

        @keyframes fadeOut {
            to {
                opacity: 0;
                transform: translateY(20px);
            }
        }
    </style>
</head>

<body class="pb-24">

    <div class="overlay"></div>

    <aside class="side-bar flex flex-col">
        <div class="p-4 text-left flex-shrink-0">
            <button id="close-btn" class="text-3xl text-gray-500 hover:text-red-500 transition-colors">&times;</button>
        </div>
        <nav class="flex-grow overflow-y-auto">
            <div class="p-4 space-y-4">
                <a href="add-product-request.html" id="sidebar-add-product-btn"
                    class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg text-lg hover:bg-blue-700 transition-all transform hover:scale-105 flex items-center justify-center gap-2 shadow-lg">
                    <i class="fas fa-plus-circle"></i>
                    <span>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</span>
                </a>

                <a href="s22marketfood.html" id="sidebar-orders-btn" target="_blank" rel="noopener noreferrer"
                    class="w-full bg-orange-500 text-white font-bold py-3 px-4 rounded-lg text-lg hover:bg-orange-600 transition-all transform hover:scale-105 flex items-center justify-center gap-2 shadow-lg">
                    <i class="fas fa-utensils"></i>
                    <span>Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØ§Ù„Ù…Ø£ÙƒÙˆÙ„Ø§Øª</span>
                </a>
            </div>

            <div class="px-6 py-2">
                <h3 class="text-lg font-bold text-gray-800 border-b pb-2">Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</h3>
            </div>
            <div id="sidebar-categories-container" class="py-2">
                <div class="text-center p-4">
                    <div class="loader mx-auto"></div>
                </div>
            </div>
        </nav>
        <div class="mt-auto p-4 border-t border-gray-200 space-y-3">
            <a href="#" id="sidebar-complaint-btn"
                class="w-full text-center text-gray-700 bg-gray-100 hover:bg-gray-200 flex items-center justify-center gap-2 border border-gray-200 font-semibold py-3 px-4 rounded-lg">
                <i class="fas fa-flag"></i> <span>Ø´ÙƒÙˆÙ‰/Ø±Ø£ÙŠ</span>
            </a>
            <a href="dashboard.html" id="admin-login-btn"
                class="w-full text-center text-gray-700 bg-gray-100 hover:bg-gray-200 flex items-center justify-center gap-2 border border-gray-200 font-semibold py-3 px-4 rounded-lg">
                <i class="fas fa-user-shield"></i> <span>Ø®Ø§Øµ Ø¨Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†</span>
            </a>
        </div>
    </aside>

    <div id="page-container">

        <header class="main-header bg-white shadow-sm sticky top-0 z-50">
            <div class="max-w-7xl mx-auto py-3 px-4 sm:px-6 lg:px-8 flex justify-between items-center">

                <button id="search-btn" class="text-2xl text-gray-600 hover:text-blue-600">
                    <i class="fas fa-search"></i>
                </button>

                <div id="logo-container" onclick="location.href='index.html'" class="cursor-pointer">
                    <h1 class="text-xl sm:text-2xl md:text-3xl font-bold text-gray-800">
                        S22<span class="text-blue-600">MARKET</span>
                    </h1>
                </div>

                <div id="header-actions" class="flex items-center gap-3 relative">
                    <button id="menu-btn" class="text-2xl text-gray-600 hover:text-blue-600"><i
                            class="fas fa-bars"></i></button>

                    <a href="login.html" id="login-btn" class="hidden"></a>
                    <div id="user-menu" class="hidden">
                        <button id="user-menu-button"
                            class="flex items-center justify-center w-10 h-10 rounded-full bg-gray-200 text-gray-600 focus:outline-none">
                            <i class="fas fa-user"></i>
                        </button>

                        <div id="user-menu-dropdown"
                            class="hidden absolute left-0 top-full mt-2 w-60 bg-white rounded-xl shadow-lg border z-50 overflow-hidden">
                            <div class="p-3 border-b">
                                <p class="text-sm text-gray-500">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒØŒ</p>
                                <p class="font-bold text-gray-800" id="user-menu-displayname">...</p>
                                <span class="hidden" id="user-menu-name"></span>
                            </div>
                            <a href="profile.html"
                                class="block px-4 py-3 text-gray-700 hover:bg-gray-100 transition-colors"><i
                                    class="fas fa-user-circle fa-fw ml-2 text-gray-400"></i> Ù…Ù„ÙÙŠ Ø§Ù„Ø´Ø®ØµÙŠ</a>
                            <div class="px-4 pt-3 pb-1 text-xs font-semibold text-gray-400 uppercase">Ø§Ù„Ù…ØªØ¬Ø±</div>
                            <a href="seller-dashboard.html"
                                class="block px-4 py-3 text-gray-700 hover:bg-gray-100 transition-colors"><i
                                    class="fas fa-store fa-fw ml-2 text-blue-400"></i> Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¨Ø§Ø¦Ø¹</a>
                            <a href="order_history.html"
                                class="block px-4 py-3 text-gray-700 hover:bg-gray-100 transition-colors"><i
                                    class="fas fa-archive fa-fw ml-2 text-gray-400"></i> Ø£Ø±Ø´ÙŠÙ Ø·Ù„Ø¨Ø§ØªÙŠ</a>
                            <a href="loyalty_card.html"
                                class="block px-4 py-3 text-gray-700 hover:bg-gray-100 transition-colors"><i
                                    class="fas fa-star fa-fw ml-2 text-orange-400"></i> Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ÙˆÙØ§Ø¡</a>
                            <a href="loyalty_tasks.html"
                                class="block px-4 py-3 text-gray-700 hover:bg-gray-100 transition-colors"><i
                                    class="fas fa-tasks fa-fw ml-2 text-purple-400"></i> Ø§Ù„Ù…Ù‡Ø§Ù…</a>
                            <a href="loyalty_rewards.html"
                                class="block px-4 py-3 text-gray-700 hover:bg-gray-100 transition-colors"><i
                                    class="fas fa-gift fa-fw ml-2 text-yellow-400"></i> Ø§Ù„Ø¬ÙˆØ§Ø¦Ø²</a>
                            <button id="logout-btn"
                                class="w-full text-right px-4 py-3 text-red-600 hover:bg-red-50 border-t transition-colors"><i
                                    class="fas fa-sign-out-alt fa-fw ml-2"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <main class="max-w-7xl mx-auto py-6 sm:py-8 md:py-10 px-4 sm:px-6 lg:px-8 space-y-12">

            <section id="offers-carousel-section" class="hidden">
                <h2 class="text-2xl font-extrabold text-gray-800 mb-4 border-r-4 border-red-500 pr-4">Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø­ØµØ±ÙŠØ© <i
                        class="fas fa-fire text-red-500"></i></h2>
                <div class="swiper swiper-container">
                    <div id="offers-carousel-wrapper" class="swiper-wrapper"></div>
                </div>
            </section>

            <section id="category-icons-section">
                <div class="swiper swiper-container">
                    <div id="category-icons-wrapper" class="swiper-wrapper"></div>
                </div>
            </section>

    </div>
    </section>

    <!-- Food Court Banner -->
    <section id="food-court-banner"
        class="rounded-2xl overflow-hidden shadow-lg relative h-48 sm:h-64 flex items-center justify-center group cursor-pointer"
        onclick="window.location.href='s22marketfood.html'">
        <div class="absolute inset-0 bg-cover bg-center transition-transform duration-700 group-hover:scale-110"
            style="background-image: url('https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&q=80&w=1000');">
        </div>
        <div class="absolute inset-0 bg-gradient-to-r from-black/80 to-transparent"></div>
        <div class="relative z-10 text-right w-full px-8">
            <h2 class="text-3xl sm:text-4xl font-extrabold text-white mb-2">S22 <span
                    class="text-orange-500">FOOD</span></h2>
            <p class="text-gray-200 text-lg sm:text-xl font-medium mb-6 max-w-md">Ø§ÙƒØªØ´Ù Ø£Ø´Ù‡Ù‰ Ø§Ù„Ù…Ø£ÙƒÙˆÙ„Ø§Øª Ù…Ù† Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ø·Ø§Ø¹Ù….
                Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†!</p>
            <button
                class="bg-orange-600 hover:bg-orange-700 text-white px-6 py-3 rounded-full font-bold transition flex items-center gap-2 w-fit">
                <i class="fas fa-utensils"></i> ØªØµÙØ­ Ø§Ù„Ù…Ø·Ø§Ø¹Ù…
            </button>
        </div>
    </section>

    <div id="dynamic-home-sections" class="space-y-12 min-h-[300px]">

        </main>
    </div>

    <a href="add-product-request.html" class="fab" title="Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬">
        <i class="fas fa-plus"></i>
    </a>

    <footer class="bg-gray-800 text-gray-300 py-10 mb-16 hidden md:block">
        <div class="max-w-7xl mx-auto px-4 grid grid-cols-1 md:grid-cols-4 gap-8">
            <div>
                <h3 class="text-white text-xl font-bold mb-4">S22 Market</h3>
                <p class="text-sm leading-relaxed">Ù…Ù†ØµØªÙƒ Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù„Ù„ØªØ³ÙˆÙ‚ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ. Ù†Ø¬Ù…Ø¹ Ù„Ùƒ Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ù…ØªØ§Ø¬Ø± Ù…ÙˆØ«ÙˆÙ‚Ø©
                    ÙˆÙ…Ø·Ø§Ø¹Ù… Ù…Ù…ÙŠØ²Ø©.</p>
            </div>
            <div>
                <h3 class="text-white font-bold mb-4">Ø±ÙˆØ§Ø¨Ø· Ø³Ø±ÙŠØ¹Ø©</h3>
                <ul class="space-y-2 text-sm">
                    <li><a href="index.html" class="hover:text-white transition">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                    <li><a href="s22marketfood.html" class="hover:text-white transition">Ø§Ù„Ù…Ø·Ø§Ø¹Ù…</a></li>
                    <li><a href="business.html" class="hover:text-white transition text-indigo-400 font-bold">Ø§Ù†Ø¶Ù…
                            ÙƒØªØ§Ø¬Ø±</a></li>
                </ul>
            </div>
            <div>
                <h3 class="text-white font-bold mb-4">Ø¯Ø¹Ù… Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h3>
                <ul class="space-y-2 text-sm">
                    <li><a href="profile.html" class="hover:text-white transition">Ø­Ø³Ø§Ø¨ÙŠ</a></li>
                    <li><a href="cart.html" class="hover:text-white transition">Ø³Ù„Ø© Ø§Ù„Ø´Ø±Ø§Ø¡</a></li>
                    <li><a href="#" class="hover:text-white transition">Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…</a></li>
                </ul>
            </div>
            <div>
                <h3 class="text-white font-bold mb-4">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</h3>
                <div class="flex space-x-4 space-x-reverse mb-4">
                    <a href="#" class="text-gray-400 hover:text-white text-xl"><i class="fab fa-facebook"></i></a>
                    <a href="#" class="text-gray-400 hover:text-white text-xl"><i class="fab fa-instagram"></i></a>
                    <a href="#" class="text-gray-400 hover:text-white text-xl"><i class="fab fa-whatsapp"></i></a>
                </div>
                <p class="text-xs text-gray-500">Â© 2025 Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p>
            </div>
        </div>
    </footer>

    <footer class="bottom-nav">
        <a href="index.html" class="nav-item active">
            <i class="fas fa-home"></i>
            <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
        </a>
        <a href="s22marketfood.html" class="nav-item text-orange-500">
            <i class="fas fa-utensils"></i>
            <span>Ø§Ù„Ù…Ø·Ø§Ø¹Ù…</span>
        </a>
        <a href="cart.html" id="bottom-cart-btn" class="nav-item relative">
            <i class="fas fa-shopping-cart"></i>
            <span>Ø§Ù„Ø³Ù„Ø©</span>
            <span id="cart-badge-bottom"
                class="hidden absolute top-0 right-1/4 bg-red-500 text-white w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold border-2 border-white">0</span>
        </a>
        <a href="profile.html" id="bottom-profile-btn" class="nav-item">
            <i class="fas fa-user-circle"></i>
            <span>Ø­Ø³Ø§Ø¨ÙŠ</span>
        </a>
        <a href="login.html" id="bottom-login-btn" class="nav-item hidden">
            <i class="fas fa-sign-in-alt"></i>
            <span>Ø§Ù„Ø¯Ø®ÙˆÙ„</span>
        </a>
    </footer>

    <div id="modal-container"></div>
    <div id="toast-container"></div>

    <script type="module">
        import { db, collection, getDocs, doc, getDoc, query, orderBy, limit, serverTimestamp, addDoc } from './js/firebase-config.js';
        import { initAuthListener, logoutUser } from './js/auth-service.js';
        import { loadCart, getCartCount } from './js/cart-service.js';
        import { showToast, showModal, closeModal, getLoaderHTML } from './js/ui-utils.js';

        // Global Cache
        let offersCache = [];
        let categoriesCache = [];
        let storeSettings = {};

        const elements = {
            modalContainer: document.getElementById('modal-container'),
            toastContainer: document.getElementById('toast-container'),

            menuBtn: document.getElementById('menu-btn'),
            loginBtn: document.getElementById('login-btn'),
            userMenu: document.getElementById('user-menu'),
            userMenuButton: document.getElementById('user-menu-button'),
            userMenuDropdown: document.getElementById('user-menu-dropdown'),
            userMenuName: document.getElementById('user-menu-name'),
            userMenuDisplayName: document.getElementById('user-menu-displayname'),
            logoutBtn: document.getElementById('logout-btn'),

            bottomCartBtn: document.getElementById('bottom-cart-btn'),
            cartBadgeBottom: document.getElementById('cart-badge-bottom'),
            bottomProfileBtn: document.getElementById('bottom-profile-btn'),
            bottomLoginBtn: document.getElementById('bottom-login-btn'),

            sidebar: document.querySelector('.side-bar'),
            overlay: document.querySelector('.overlay'),
            closeSidebarBtn: document.getElementById('close-btn'),
            sidebarCategoriesContainer: document.getElementById('sidebar-categories-container'),
            sidebarComplaintBtn: document.getElementById('sidebar-complaint-btn'),
            sidebarAddProductBtn: document.getElementById('sidebar-add-product-btn'),
            sidebarOrdersBtn: document.getElementById('sidebar-orders-btn'),

            offersCarouselSection: document.getElementById('offers-carousel-section'),
            offersCarouselWrapper: document.getElementById('offers-carousel-wrapper'),
            categoryIconsWrapper: document.getElementById('category-icons-wrapper'),
            dynamicHomeSections: document.getElementById('dynamic-home-sections')
        };

        // --- Inquiry Logic ---

        // Expose to window for legacy onclick support if needed, or simply handle internally
        window.showInquiryModal = (type) => {
            const title = type === 'complaint' ? 'ØªÙ‚Ø¯ÙŠÙ… Ø´ÙƒÙˆÙ‰ Ø£Ùˆ Ø±Ø£ÙŠ' : 'Ø·Ù„Ø¨ Ù…Ù†ØªØ¬';
            const content = `
            <form id="inquiry-form" class="space-y-4">
                <p class="text-sm text-gray-600">Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„ØªÙƒ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©.</p>
                <div>
                    <label class="font-semibold text-sm">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ <span class="text-red-500">*</span></label>
                    <input type="text" id="inq-name" class="mt-1 w-full p-2 border rounded" required>
                </div>
                <div>
                    <label class="font-semibold text-sm">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ <span class="text-red-500">*</span></label>
                    <input type="tel" id="inq-phone" class="mt-1 w-full p-2 border rounded" dir="ltr" required>
                </div>
                <div>
                    <label class="font-semibold text-sm">Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø© / Ø§Ù„Ø·Ù„Ø¨ <span class="text-red-500">*</span></label>
                    <textarea id="inq-message" rows="4" class="mt-1 w-full p-2 border rounded" required></textarea>
                </div>
                <div class="text-left">
                    <button type="submit" id="inq-submit-btn" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 flex items-center gap-2">
                        <span class="button-text">Ø¥Ø±Ø³Ø§Ù„</span>
                        <div class="small-loader button-loader hidden"></div>
                    </button>
                </div>
            </form>`;

            showModal(title, content);

            setTimeout(() => {
                const form = document.getElementById('inquiry-form');
                if (form) form.onsubmit = (e) => handleInquirySubmit(e, type);
            }, 100);
        };

        async function handleInquirySubmit(e, type) {
            e.preventDefault();
            const btn = document.getElementById('inq-submit-btn');
            const btnText = btn.querySelector('.button-text');
            const btnLoader = btn.querySelector('.button-loader');

            if (btn) btn.disabled = true;
            if (btnText) btnText.classList.add('hidden');
            if (btnLoader) btnLoader.classList.remove('hidden');

            try {
                const data = {
                    type: type,
                    fullName: document.getElementById('inq-name').value,
                    phone: document.getElementById('inq-phone').value,
                    message: document.getElementById('inq-message').value,
                    status: 'Ø¬Ø¯ÙŠØ¯',
                    createdAt: serverTimestamp()
                };
                await addDoc(collection(db, "inquiries"), data);
                closeModal();
                showToast('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­ØŒ Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ.', true);
            } catch (error) {
                console.error("Error submitting inquiry:", error);
                showToast('ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹.', false);
            } finally {
                if (btn) btn.disabled = false;
                if (btnText) btnText.classList.remove('hidden');
                if (btnLoader) btnLoader.classList.add('hidden');
            }
        }

        function showRedirectModal({ title, icon, message, targetUrl }) {
            const content = `
            <div class="text-center p-4">
                <div class="text-6xl mb-4">${icon}</div>
                <p class="text-lg text-gray-700">${message}</p>
                <a href="${targetUrl}" target="_blank" rel="noopener noreferrer" class="mt-6 w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg text-lg hover:bg-blue-700 transition-all transform hover:scale-105 flex items-center justify-center gap-2">
                    <i class="fas fa-external-link-alt"></i>
                    Ù…ØªØ§Ø¨Ø¹Ø©
                </a>
            </div>`;
            showModal(title, content);
        }

        // --- UI Interactions ---

        const closeSidebar = () => {
            elements.sidebar.classList.remove('active');
            elements.overlay.classList.remove('active');
            document.body.style.overflow = 'auto';
        };

        function updateCartUI() {
            const totalItems = getCartCount();
            elements.cartBadgeBottom.textContent = totalItems;
            elements.cartBadgeBottom.classList.toggle('hidden', totalItems === 0);
        }

        // --- Data Fetching ---

        async function loadStoreSettings() {
            try {
                const settingsDoc = await getDoc(doc(db, "settings", "storeConfig"));
                if (settingsDoc.exists()) {
                    storeSettings = settingsDoc.data();
                    document.title = storeSettings.seoTitle || 'S22 Market';
                }
            } catch (e) { console.error("Store settings error:", e); }
        }

        // --- Timer Logic ---
        function updateCountdowns() {
            const countdownElements = document.querySelectorAll('.countdown-timer');
            countdownElements.forEach(el => {
                const endTime = el.dataset.endTime;
                if (!endTime) return;
                const t = calculateTimeRemaining(endTime);
                if (t.total <= 0) {
                    el.parentElement.classList.add('hidden');
                } else {
                    el.innerHTML = `
                    <div>${t.days} <span>ÙŠÙˆÙ…</span></div> :
                    <div>${t.hours} <span>Ø³</span></div> :
                    <div>${t.minutes} <span>Ø¯</span></div> :
                    <div>${t.seconds} <span>Ø«</span></div>
                `;
                }
            });
        }

        function calculateTimeRemaining(endtime) {
            const total = Date.parse(endtime) - Date.parse(new Date());
            const seconds = Math.floor((total / 1000) % 60);
            const minutes = Math.floor((total / 1000 / 60) % 60);
            const hours = Math.floor((total / (1000 * 60 * 60)) % 24);
            const days = Math.floor(total / (1000 * 60 * 60 * 24));
            return { total, days, hours, minutes, seconds };
        }

        // --- Rendering ---

        function createOfferCard(offer) {
            const card = document.createElement('div');
            card.className = 'swiper-slide offer-carousel-card';
            const image = offer.imageUrl || 'https://placehold.co/400x200';

            let countdownHTML = '';
            if (offer.expiryDate && offer.expiryDate.toDate) {
                const expiryTime = offer.expiryDate.toDate();
                if (expiryTime > new Date()) {
                    countdownHTML = `
                <div class="countdown-timer-container">
                    <span class="countdown-label"><i class="fas fa-fire-alt ml-1"></i> ÙŠÙ†ØªÙ‡ÙŠ Ø§Ù„Ø¹Ø±Ø¶:</span>
                    <div class="countdown-timer" data-end-time="${expiryTime.toISOString()}"></div>
                </div>`;
                }
            }

            card.innerHTML = `
            <a href="PRESENTPRODUCT.html?offer=${offer.id}" class="block">
                <div class="offer-carousel-image" style="background-image: url('${image}')"></div>
                <h3 class="offer-carousel-title">${offer.title}</h3>
                <p class="offer-price">${(offer.price || 0).toLocaleString()} Ø¯.Ø¬</p>
                ${countdownHTML}
            </a>`;
            return card;
        }

        async function fetchAndRenderOffers() {
            try {
                const snapshot = await getDocs(query(collection(db, "offers"), orderBy("createdAt", "desc"), limit(5)));
                offersCache = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data(), isOffer: true }));

                if (offersCache.length > 0) {
                    elements.offersCarouselWrapper.innerHTML = '';
                    offersCache.forEach(offer => {
                        elements.offersCarouselWrapper.appendChild(createOfferCard(offer));
                    });
                    elements.offersCarouselSection.classList.remove('hidden');

                    new Swiper('#offers-carousel-section .swiper-container', {
                        slidesPerView: 'auto',
                        spaceBetween: 16,
                        freeMode: true,
                    });

                    if (document.querySelector('.countdown-timer')) {
                        updateCountdowns();
                        setInterval(updateCountdowns, 1000);
                    }
                }
            } catch (error) { console.error("Offers error:", error); }
        }

        async function fetchAndRenderCategories() {
            try {
                const snapshot = await getDocs(query(collection(db, "categories"), orderBy("orderIndex")));
                categoriesCache = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

                let categoriesIconsHTML = '';
                let categoriesSidebarHTML = `<div class="p-2 space-y-1">`;

                categoriesIconsHTML += `
                <a href="classproductindex.html" class="swiper-slide category-icon-item">
                    <div class="category-icon-circle"><i class="fas fa-store text-2xl text-gray-500"></i></div>
                    <span>ÙƒÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</span>
                </a>`;

                categoriesCache.forEach(cat => {
                    const activeSubcategories = cat.subcategories?.filter(s => s.active && s.id) || [];
                    categoriesIconsHTML += `
                <a href="classproductindex.html?category=${cat.id}" class="swiper-slide category-icon-item">
                    <div class="category-icon-circle"><i class="fas fa-tags text-2xl text-blue-500"></i></div>
                    <span>${cat.name}</span>
                </a>`;

                    categoriesSidebarHTML += `
                    <div>
                        <a href="classproductindex.html?category=${cat.id}" class="flex items-center justify-between gap-4 p-3 text-lg font-semibold rounded-lg category-filter-btn hover:bg-gray-100">
                            <div class="flex items-center gap-4"><i class="fas fa-tags w-8 text-center text-gray-400"></i> <span>${cat.name}</span></div>
                            ${activeSubcategories.length > 0 ? `<i class="fas fa-chevron-down text-sm text-gray-400"></i>` : ''}
                        </a>`;
                    if (activeSubcategories.length > 0) {
                        categoriesSidebarHTML += `<div class="pr-8 mt-1 space-y-1 hidden">`;
                        activeSubcategories.forEach(sub => {
                            categoriesSidebarHTML += `<a href="classproductindex.html?subcategory=${sub.id}" class="block p-2 rounded-md hover:bg-gray-100 text-gray-600 font-medium">${sub.name}</a>`;
                        });
                        categoriesSidebarHTML += `</div>`;
                    }
                    categoriesSidebarHTML += `</div>`;
                });
                categoriesSidebarHTML += `</div>`;

                elements.categoryIconsWrapper.innerHTML = categoriesIconsHTML;
                new Swiper('#category-icons-section .swiper-container', {
                    slidesPerView: 'auto',
                    spaceBetween: 16,
                    freeMode: true,
                });
                elements.sidebarCategoriesContainer.innerHTML = categoriesSidebarHTML;

            } catch (error) { console.error("Categories error:", error); }
        }

        function createProductCard(product) {
            const card = document.createElement('div');
            card.className = 'swiper-slide carousel-card';

            const image = (product.imageUrls && product.imageUrls.length > 0) ? product.imageUrls[0] : 'https://placehold.co/300x300';
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = product.name;
            const productName = tempDiv.textContent || tempDiv.innerText || "";

            let cardLink = `PRESENTPRODUCT.html?product=${product.id}`;
            let priceHTML = `<p class="text-blue-600 font-bold mx-2 mb-2">${(product.price || 0).toLocaleString()} Ø¯.Ø¬</p>`;

            if (product.productType === 'direct') {
                priceHTML = `<p class="text-green-600 font-bold mx-2 mb-2">Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</p>`;
            }

            card.innerHTML = `
            <a href="${cardLink}" class="block flex flex-col flex-grow">
                <div class="carousel-card-image" style="background-image: url('${image}')"></div>
                <div class="carousel-card-content">
                    <h3 class="carousel-card-title">${productName}</h3>
                    <div class="flex-grow"></div> ${priceHTML}
                </div>
            </a>`;
            return card;
        }

        function createSectionHTML(sectionId, title, colorClass = 'blue') {
            return `
            <section id="${sectionId}" class="fade-in-section">
                <h2 class="text-2xl font-extrabold text-gray-800 mb-4 border-r-4 border-${colorClass}-500 pr-4 flex items-center justify-between">
                    <span>${title}</span>
                    <a href="classproductindex.html" class="text-sm font-normal text-indigo-600 hover:underline ml-2">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„ <i class="fas fa-angle-left text-xs"></i></a>
                </h2>
                <div class="swiper swiper-container">
                    <div class="swiper-wrapper" id="${sectionId}-wrapper"></div>
                </div>
            </section>
        `;
        }

        async function fetchAndRenderDynamicHome() {
            const container = elements.dynamicHomeSections;
            try {
                const sectionsSnapshot = await getDocs(query(collection(db, "home_sections"), orderBy("orderIndex")));
                const sectionsConfig = sectionsSnapshot.docs.map(d => d.data());

                // Simple fetch, optimization later
                // We exclude 'course' type to match original logic
                const productsQuery = query(collection(db, "products"), orderBy("createdAt", "desc"), limit(100));
                const productsSnapshot = await getDocs(productsQuery);
                const allProducts = productsSnapshot.docs
                    .map(d => ({ id: d.id, ...d.data() }))
                    .filter(p => p.productType !== 'course' && p.availability !== 'sold_out');

                container.innerHTML = '';

                if (sectionsConfig.length === 0) {
                    container.innerHTML = createSectionHTML('default-recent', 'ÙˆØµÙ„ Ø­Ø¯ÙŠØ«Ø§Ù‹ âœ¨', 'indigo');
                    const wrapper = document.getElementById('default-recent-wrapper');
                    allProducts.slice(0, 10).forEach(p => wrapper.appendChild(createProductCard(p)));
                    new Swiper('#default-recent .swiper-container', { slidesPerView: 'auto', spaceBetween: 16, freeMode: true });
                    return;
                }

                sectionsConfig.forEach((section, index) => {
                    const sectionId = `section-${index}`;
                    const color = ['blue', 'red', 'green', 'purple', 'orange'][index % 5];
                    container.insertAdjacentHTML('beforeend', createSectionHTML(sectionId, section.title, color));
                    const wrapper = document.getElementById(`${sectionId}-wrapper`);

                    let filteredProducts = [];
                    if (section.type === 'recent') filteredProducts = allProducts.slice(0, 10);
                    else if (section.type === 'category' && section.config?.categoryId) filteredProducts = allProducts.filter(p => p.categoryId === section.config.categoryId);
                    else if (section.type === 'offers') filteredProducts = allProducts.slice(5, 15);

                    if (filteredProducts.length > 0) {
                        filteredProducts.forEach(product => wrapper.appendChild(createProductCard(product)));
                        new Swiper(`#${sectionId} .swiper-container`, { slidesPerView: 'auto', spaceBetween: 16, freeMode: true });
                    } else {
                        document.getElementById(sectionId).style.display = 'none';
                    }
                });

            } catch (error) {
                console.error("Dynamic home error:", error);
                let errorMsg = "Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª.";
                if (error && error.message && error.message.includes("index")) errorMsg += "<br><br><b>Ø§Ù„Ø³Ø¨Ø¨:</b> ÙŠØªØ·Ù„Ø¨ Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… ÙÙ‡Ø±Ø³Ø§Ù‹ (Index). ÙŠØ±Ø¬Ù‰ ÙØªØ­ 'Console' ÙˆØ§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ø¥Ù†Ø´Ø§Ø¦Ù‡.";
                else if (error && error.code === "permission-denied") errorMsg += "<br><br><b>Ø§Ù„Ø³Ø¨Ø¨:</b> Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©. ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ø¯ÙŠØ« 'Firestore Rules'.";
                else errorMsg += `<br><br><b>Ø§Ù„ØªÙØ§ØµÙŠÙ„:</b> ${error ? error.message : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}`;

                container.innerHTML = `<div class="text-center py-10 text-red-500 bg-red-50 rounded-lg mx-4">
                    <p class="font-bold text-lg">${errorMsg}</p>
                    <button onclick="location.reload()" class="mt-4 bg-blue-600 text-white px-6 py-2 rounded-full hover:bg-blue-700 transition">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
                </div>`;
            }
        }

        async function initializeStore() {
            // Sidebar Events
            if (elements.menuBtn) {
                elements.menuBtn.onclick = () => {
                    elements.sidebar.classList.add('active');
                    elements.overlay.classList.add('active');
                    document.body.style.overflow = 'hidden';
                };
            }
            if (elements.closeSidebarBtn) elements.closeSidebarBtn.onclick = closeSidebar;
            if (elements.overlay) elements.overlay.onclick = closeSidebar;

            if (elements.sidebarComplaintBtn) {
                elements.sidebarComplaintBtn.onclick = (e) => {
                    e.preventDefault();
                    window.showInquiryModal('complaint');
                    closeSidebar();
                };
            }

            if (elements.sidebarAddProductBtn) {
                elements.sidebarAddProductBtn.onclick = (e) => {
                    e.preventDefault();
                    closeSidebar();
                    showRedirectModal({
                        title: "Ø¹Ø±Ø¶ Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯",
                        icon: "ğŸ“¦",
                        message: "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒØŒ ÙŠØ¨Ø¯Ùˆ Ø£Ù† Ù„Ø¯ÙŠÙƒ Ù…Ù†ØªØ¬ ØªØ±ÙŠØ¯ Ø¹Ø±Ø¶Ù‡ ÙŠØ§ Ø²Ø¨ÙˆÙ†Ù†Ø§ Ø§Ù„ÙƒØ±ÙŠÙ….",
                        targetUrl: e.currentTarget.href
                    });
                };
            }

            if (elements.sidebarOrdersBtn) {
                elements.sidebarOrdersBtn.onclick = (e) => {
                    e.preventDefault();
                    closeSidebar();
                    showRedirectModal({
                        title: "Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØ§Ù„Ù…Ø£ÙƒÙˆÙ„Ø§Øª",
                        icon: "ğŸ˜‹",
                        message: "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø²Ø§Ø¦Ø±Ù†Ø§ Ø§Ù„ÙƒØ±ÙŠÙ…ØŒ Ù„Ø§ ØªÙ†Ø³Ù‰ØŒ Ù†Ø­Ù† Ù†Ù‡ØªÙ… Ø¨ÙƒÙ„ Ø´ÙŠØ¡ Ø¹ÙˆØ¶Ø§Ù‹ Ø¹Ù†Ùƒ.",
                        targetUrl: e.currentTarget.href
                    });
                };
            }

            // User Menu
            if (elements.userMenuButton) {
                elements.userMenuButton.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (elements.userMenuDropdown) elements.userMenuDropdown.classList.toggle('show');
                });
            }
            document.addEventListener('click', (e) => {
                if (elements.userMenuDropdown && elements.userMenuDropdown.classList.contains('show') && !elements.userMenuButton.contains(e.target)) {
                    elements.userMenuDropdown.classList.remove('show');
                }
            });

            if (elements.logoutBtn) {
                elements.logoutBtn.addEventListener('click', async () => {
                    await logoutUser();
                    window.location.reload();
                });
            }

            if (elements.bottomCartBtn) elements.bottomCartBtn.onclick = () => window.location.href = 'cart.html';

            // 2. Load Local Data
            loadCart();
            updateCartUI();

            // 3. Start Async Data Fetching (Non-blocking for UI)
            // We trigger them but allow the UI to remain responsive
            try {
                await Promise.all([
                    loadStoreSettings(),
                    fetchAndRenderCategories(),
                    fetchAndRenderOffers(),
                    fetchAndRenderDynamicHome()
                ]);
            } catch (error) {
                console.error("Initialization error:", error);
                // Ensure loader is removed even if error occurs
                if (elements.dynamicHomeSections) {
                    elements.dynamicHomeSections.innerHTML = `<div class="text-center py-10 text-red-500">
                    <p>Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØªØ¬Ø±.</p>
                    <button onclick="location.reload()" class="mt-4 bg-blue-600 text-white px-4 py-2 rounded">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
                </div>`;
                }
            }

            // Auth Logic
            initAuthListener({
                onLogin: (user) => {
                    if (elements.bottomProfileBtn) elements.bottomProfileBtn.classList.remove('hidden');
                    if (elements.bottomLoginBtn) elements.bottomLoginBtn.classList.add('hidden');
                    if (elements.loginBtn) {
                        elements.loginBtn.classList.add('hidden');
                        elements.loginBtn.classList.remove('sm:flex');
                    }
                    if (elements.userMenu) elements.userMenu.classList.remove('hidden');

                    const displayName = user.displayName || "Ø²Ø¨ÙˆÙ†Ù†Ø§";
                    if (elements.userMenuName) elements.userMenuName.textContent = displayName.split(' ')[0];
                    if (elements.userMenuDisplayName) elements.userMenuDisplayName.textContent = displayName;
                },
                onLogout: () => {
                    if (elements.bottomProfileBtn) elements.bottomProfileBtn.classList.add('hidden');
                    if (elements.bottomLoginBtn) elements.bottomLoginBtn.classList.remove('hidden');
                    if (elements.loginBtn) {
                        elements.loginBtn.classList.remove('hidden');
                        elements.loginBtn.classList.add('sm:flex');
                    }
                    if (elements.userMenu) elements.userMenu.classList.add('hidden');
                }
            });
        }

        initializeStore();
    </script>
</body>

</html>