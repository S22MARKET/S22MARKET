<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨ - S22 Market</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="app-style.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            background: linear-gradient(135deg, #f6f8fb 0%, #e9f0f8 100%);
            overflow-x: hidden;
        }





        /* Cartoon Road Animation */
        .road-container {
            position: relative;
            width: 120%;
            height: 120px;
            background: #374151;
            transform: rotate(-2deg);
            left: -10%;
            margin-top: 40px;
            overflow: hidden;
            border-top: 6px solid #4b5563;
            border-bottom: 6px solid #4b5563;
        }

        .road-stripes {
            position: absolute;
            top: 50%;
            left: 0;
            width: 200%;
            height: 10px;
            background: repeating-linear-gradient(90deg,
                    transparent 0,
                    transparent 40px,
                    #fbbf24 40px,
                    #fbbf24 80px);
            transform: translateY(-50%);
            animation: moveRoad 1s linear infinite;
        }

        @keyframes moveRoad {
            0% {
                transform: translate(0, -50%);
            }

            100% {
                transform: translate(-80px, -50%);
            }
        }

        /* Bouncy Bike */
        .bike-wrapper {
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
        }

        .bike-icon {
            font-size: 80px;
            color: #f97316;
            filter: drop-shadow(0 10px 10px rgba(0, 0, 0, 0.2));
            animation: bounceBike 0.6s infinite alternate cubic-bezier(0.5, 0.05, 0.1, 0.3);
        }

        .bike-wind {
            position: absolute;
            top: 40px;
            right: -20px;
            opacity: 0;
            animation: windEffect 0.5s infinite linear;
        }

        @keyframes bounceBike {
            from {
                transform: translateY(0) rotate(2deg);
            }

            to {
                transform: translateY(-5px) rotate(-2deg);
            }
        }

        @keyframes windEffect {
            0% {
                transform: translateX(0);
                opacity: 0.8;
            }

            100% {
                transform: translateX(-20px);
                opacity: 0;
            }
        }

        /* Glass Cards */
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 32px rgba(99, 102, 241, 0.1);
        }

        .social-btn {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .social-btn:active {
            transform: scale(0.95);
        }
    </style>
</head>

<body class="min-h-screen flex flex-col items-center pb-10">

    <!-- Header -->
    <div class="w-full max-w-md p-4 flex justify-between items-center z-20">
        <a href="order_history.html" class="bg-white/80 p-3 rounded-full shadow-sm hover:bg-white transition-colors">
            <i class="fas fa-arrow-right text-gray-700"></i>
        </a>
        <h1 class="font-extrabold text-gray-800 tracking-wide">ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨</h1>
        <div class="w-10"></div>
    </div>

    <!-- Animated Scene -->
    <div class="w-full max-w-md relative mb-6 overflow-hidden">
        <div class="road-container shadow-xl">
            <div class="road-stripes"></div>
        </div>

        <div class="bike-wrapper">
            <div class="bike-icon"><i class="fas fa-motorcycle"></i></div>
            <div class="bike-wind text-gray-400 text-2xl"><i class="fas fa-wind"></i></div>
        </div>

        <!-- Clouds Decoration -->
        <i class="fas fa-cloud text-white/60 text-4xl absolute top-0 right-10 animate-pulse"></i>
        <i class="fas fa-cloud text-white/40 text-3xl absolute top-10 left-5 animate-pulse"
            style="animation-delay: 1s"></i>
    </div>

    <!-- Main Status Card -->
    <div class="w-full max-w-md px-4 relative z-10 -mt-8 space-y-4">

        <!-- Customer Greeting -->
        <div class="glass-card rounded-2xl p-6 text-center animate-fade-in-up">
            <div class="w-16 h-1 bg-gradient-to-r from-orange-400 to-indigo-500 mx-auto rounded-full mb-4"></div>
            <h2 class="text-2xl font-black text-gray-800 leading-snug mb-2">
                ÙŠØªÙ… ØªÙˆØµÙŠÙ„ Ù…Ù†ØªØ¬ÙƒÙ… ÙŠØ§ <span class="text-indigo-600 inline-block" id="customer-name">...</span> ğŸ“¦
            </h2>
            <p class="text-gray-500 font-medium text-sm">Ø´ÙƒØ±Ø§Ù‹ Ù„Ø«Ù‚ØªÙƒÙ… Ø¨Ù†Ø§!</p>

            <div id="status-badge"
                class="mt-4 inline-flex items-center gap-2 bg-green-100 text-green-700 px-4 py-2 rounded-full font-bold text-sm">
                <i class="fas fa-circle text-[10px] animate-pulse"></i>
                <span id="order-status-text">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¶ÙŠØ±...</span>
            </div>
        </div>

        <!-- Seller Contact -->
        <div class="glass-card rounded-2xl p-6 border-t-4 border-indigo-500">
            <div class="text-center mb-6">
                <div
                    class="w-14 h-14 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-3 text-indigo-600 text-2xl shadow-inner">
                    <i class="fas fa-store"></i>
                </div>
                <h3 class="font-bold text-gray-700">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨Ø§Ø¦Ø¹</h3>
                <p class="text-xs text-gray-500 mt-1">Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø£ÙƒØ«Ø± Ø¥ØªØµÙ„ Ø¹Ù„Ù‰ <span class="font-bold text-gray-800"
                        id="seller-name">S22 Store</span></p>
            </div>

            <!-- Dynamic Social Buttons -->
            <div class="grid grid-cols-4 gap-3" id="seller-contacts">
                <!-- Buttons will be injected here -->
                <div class="col-span-4 text-center py-4 text-gray-400 text-xs">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„...</div>
            </div>
        </div>

        <!-- S22 Platform Support -->
        <div class="glass-card rounded-2xl p-5 bg-gradient-to-br from-gray-900 to-gray-800 border-none text-white">
            <div class="flex items-center gap-3 mb-4">
                <div class="w-10 h-10 bg-white/10 rounded-full flex items-center justify-center">
                    <i class="fas fa-headset text-yellow-400"></i>
                </div>
                <div>
                    <h4 class="font-bold text-sm">ÙÙŠ Ø­Ø§Ù„Ø© Ø£Ø®Ø±Ù‰ Ø§ØªØµÙ„ Ø¨Ù†Ø§</h4>
                    <p class="text-[10px] text-gray-400 tracking-wider font-mono">S22 MARKET SUPPORT</p>
                </div>
            </div>

            <div class="flex gap-3">
                <a href="tel:0656565656"
                    class="flex-1 bg-white/10 hover:bg-white/20 p-2 rounded-lg text-center transition-colors social-btn">
                    <i class="fas fa-phone mb-1 block text-green-400"></i>
                    <span class="text-[10px] font-bold">Ù‡Ø§ØªÙ</span>
                </a>
                <a href="mailto:support@s22market.com"
                    class="flex-1 bg-white/10 hover:bg-white/20 p-2 rounded-lg text-center transition-colors social-btn">
                    <i class="fas fa-envelope mb-1 block text-blue-400"></i>
                    <span class="text-[10px] font-bold">Ø¥ÙŠÙ…ÙŠÙ„</span>
                </a>
                <a href="#"
                    class="flex-1 bg-white/10 hover:bg-white/20 p-2 rounded-lg text-center transition-colors social-btn">
                    <i class="fab fa-whatsapp mb-1 block text-green-500"></i>
                    <span class="text-[10px] font-bold">ÙˆØ§ØªØ³Ø§Ø¨</span>
                </a>
            </div>
        </div>

        <div class="text-center py-4 text-gray-300 text-[10px]">
            &copy; 2025 S22 MARKET
        </div>
    </div>

    <!-- Logic -->
    <script type="module">
        import { db, auth } from './app-core.js';
        import { doc, getDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const orderId = new URLSearchParams(window.location.search).get('orderId');

        async function init() {
            // Auth check (Optional: tracking might be public or require generic auth)
            // assuming user is logged in for "Order History" context

            if (!orderId) {
                // "Reassure Mode" - Default Positive State
                updateOrderUI({
                    status: 'shipping', // Show bike animation
                    customerName: 'Ø¹Ù…ÙŠÙ„Ù†Ø§ Ø§Ù„Ø¹Ø²ÙŠØ²'
                });

                // Hide specific seller section if we don't know the seller, or show generic
                document.getElementById('seller-contacts').innerHTML = '<div class="col-span-4 text-center text-gray-400 text-xs py-2">ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ Ù„Ù„Ù…Ù†ØµØ© ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„</div>';
                return;
            }

            // Real-time Order Listener
            onSnapshot(doc(db, "orders", orderId), async (docSnap) => {
                if (docSnap.exists()) {
                    const order = docSnap.data();
                    updateOrderUI(order);

                    // Fetch Seller Details Once
                    if (order.sellerId) {
                        try {
                            const sellerSnap = await getDoc(doc(db, "users", order.sellerId));
                            if (sellerSnap.exists()) {
                                updateSellerContacts(sellerSnap.data());
                            }
                        } catch (err) {
                            console.error("Seller fetch error:", err);
                        }
                    }
                } else {
                    document.getElementById('order-status-text').textContent = "Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯";
                }
            });
        }

        function updateOrderUI(order) {
            // Customer Name
            const nameEl = document.getElementById('customer-name');
            nameEl.textContent = order.customerName || 'Ø¹Ù…ÙŠÙ„Ù†Ø§ Ø§Ù„Ø¹Ø²ÙŠØ²';

            // Status Styling
            const statusMap = {
                'new': { text: 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯', color: 'bg-yellow-100 text-yellow-800' },
                'preparing': { text: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¶ÙŠØ±', color: 'bg-blue-100 text-blue-800' },
                'ready': { text: 'Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù…/Ø§Ù„ØªÙˆØµÙŠÙ„', color: 'bg-indigo-100 text-indigo-800' },
                'shipping': { text: 'ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚ Ø¥Ù„ÙŠÙƒ', color: 'bg-orange-100 text-orange-800' },
                'completed': { text: 'ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„', color: 'bg-green-100 text-green-800' },
                'canceled': { text: 'Ù…Ù„ØºÙŠ', color: 'bg-red-100 text-red-800' }
            };

            const status = statusMap[order.status] || { text: order.status, color: 'bg-gray-100 text-gray-800' };
            const badge = document.getElementById('status-badge');
            const statusText = document.getElementById('order-status-text');

            badge.className = `mt-4 inline-flex items-center gap-2 px-4 py-2 rounded-full font-bold text-sm ${status.color} shadow-sm`;
            statusText.textContent = status.text;
        }

        function updateSellerContacts(seller) {
            const container = document.getElementById('seller-contacts');
            const nameEl = document.getElementById('seller-name');

            if (seller.storeName) nameEl.textContent = seller.storeName;

            let html = '';

            // Checking logic for common fields, adapting to potential variable names
            // Convention: facebook, instagram, phone, telegram, whatsapp

            const platforms = [
                { key: 'phone', icon: 'fa-phone', label: 'Ø§ØªØµØ§Ù„', color: 'text-green-600', prefix: 'tel:' },
                { key: 'whatsapp', icon: 'fa-whatsapp', label: 'ÙˆØ§ØªØ³Ø§Ø¨', color: 'text-green-500', prefix: 'https://wa.me/', isFab: true },
                { key: 'facebook', icon: 'fa-facebook-f', label: 'ÙÙŠØ³Ø¨ÙˆÙƒ', color: 'text-blue-600', prefix: '' },
                { key: 'instagram', icon: 'fa-instagram', label: 'Ø§Ù†Ø³ØªØºØ±Ø§Ù…', color: 'text-pink-600', prefix: '' },
                { key: 'telegram', icon: 'fa-telegram-plane', label: 'ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…', color: 'text-sky-500', prefix: '' },
                { key: 'tiktok', icon: 'fa-tiktok', label: 'ØªÙŠÙƒ ØªÙˆÙƒ', color: 'text-black', prefix: '' }
            ];

            let found = false;

            platforms.forEach(p => {
                let val = seller[p.key] || seller[`set-${p.key}`]; // Try direct or form id style

                // Specific checks based on dashboard verify
                if (p.key === 'facebook') val = seller.facebook || seller.fbLink;
                if (p.key === 'instagram') val = seller.instagram || seller.instaLink;

                if (val) {
                    found = true;
                    // Handle URL formatting
                    let href = val;
                    if (p.prefix && !val.startsWith('http') && !val.startsWith(p.prefix)) {
                        href = p.prefix + val;
                    }

                    const iconClass = p.isFab ? 'fab' : 'fas'; // Awesome font Logic
                    const iconPure = p.isFab || p.key === 'facebook' || p.key === 'instagram' || p.key === 'tiktok' || p.key === 'telegram' ? `fab ${p.icon}` : `fas ${p.icon}`;

                    html += `
                        <a href="${href}" target="_blank" class="flex flex-col items-center gap-2 p-3 rounded-xl bg-white border border-gray-100 shadow-sm hover:shadow-md hover:-translate-y-1 transition-all social-btn">
                            <i class="${iconPure} text-2xl ${p.color}"></i>
                            <span class="text-[10px] font-bold text-gray-600">${p.label}</span>
                        </a>
                    `;
                }
            });

            if (!found) {
                html = '<div class="col-span-4 text-center text-gray-400 text-xs py-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØªÙˆØ§ØµÙ„ Ø¥Ø¶Ø§ÙÙŠØ©</div>';
            }

            container.innerHTML = html;
        }

        init();
    </script>
</body>

</html>