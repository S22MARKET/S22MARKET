






















































<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S22MARKET - نافذة ترحيب وأذكار</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Scheherazade+New:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Amiri+Quran&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

    <style>
        /* =================================================================== */
        /* S22MARKET - نسخة مطورة ومنقحة (منطق كل ساعتين + تحسينات للهاتف)   */
        /* =================================================================== */

        :root {
            --adm-bg-color: #f0f4f8;
            --adm-modal-bg: #ffffff;
            --adm-primary-text: #1c3d5a;
            --adm-secondary-text: #5a7b9d;
            --adm-reminder-text: #607d8b;
            --adm-primary-accent: #007bff;
            --adm-primary-accent-hover: #0056b3;
            --adm-success-color: #28a745;
            --adm-subtle-border: rgba(0, 123, 255, 0.15);
            
            --adm-border-radius-lg: 20px;
            --adm-border-radius-md: 14px;
            
            --adm-shadow: 0 15px 45px rgba(0, 123, 255, 0.18);
            --adm-transition: all 0.3s ease-in-out;
        }

        *, *::before, *::after { box-sizing: border-box; }

        body {
            font-family: 'Scheherazade New', serif;
            font-weight: 500;
            margin: 0;
            background-color: var(--adm-bg-color);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .adm-modal-overlay {
            display: flex;
            justify-content: center;
            align-items: center;
            position: fixed;
            inset: 0;
            z-index: 99999;
            padding: 1rem;
            background-color: rgba(10, 30, 50, 0.6);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            overflow-y: auto;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease, visibility 0.5s;
        }

        .adm-modal-overlay.is-visible {
            opacity: 1;
            visibility: visible;
        }
        
        .adm-modal-content, .adm-jumaa-message-content, .isn-modal-content {
            background: var(--adm-modal-bg);
            padding: clamp(1.2rem, 5vw, 2.2rem);
            border-radius: var(--adm-border-radius-lg);
            box-shadow: var(--adm-shadow);
            width: 100%;
            max-width: 500px;
            text-align: center;
            border-top: 6px solid var(--adm-primary-accent);
            transform: translateY(25px) scale(0.97);
            opacity: 0;
            transition: transform 0.4s ease-out, opacity 0.4s ease-out;
            display: flex;
            flex-direction: column;
            gap: clamp(1rem, 4vw, 1.5rem);
        }

        .is-visible .adm-modal-content,
        .is-visible .adm-jumaa-message-content,
        .is-visible .isn-modal-content {
            transform: translateY(0) scale(1);
            opacity: 1;
            transition-delay: 0.1s;
        }
        
        .adm-hidden { display: none !important; }
        
        .adm-modal-header h2 {
            font-size: clamp(1.8rem, 6vw, 2.5rem);
            font-weight: 700;
            color: var(--adm-primary-text);
            margin: 0;
            line-height: 1.4;
        }
        
        .adm-tasks-header {
            font-size: clamp(1.1rem, 4vw, 1.3rem);
            line-height: 1.8;
            color: var(--adm-secondary-text);
            margin: 0.25rem 0 0 0;
        }

        .adm-dhikr-btn {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: clamp(0.8rem, 3.5vw, 1rem) clamp(1rem, 4.5vw, 1.3rem);
            font-size: clamp(1.2rem, 5vw, 1.4rem);
            font-weight: 700;
            font-family: 'Scheherazade New', serif;
            color: #fff;
            background: linear-gradient(45deg, var(--adm-primary-accent), #4dabf7);
            border: none;
            border-bottom: 3px solid var(--adm-primary-accent-hover);
            border-radius: var(--adm-border-radius-md);
            cursor: pointer;
            transition: var(--adm-transition);
            text-decoration: none;
        }
        
        .adm-dhikr-btn .adm-icon { margin-left: 15px; font-size: 1.3em; }
        .adm-dhikr-btn .adm-btn-text { flex-grow: 1; text-align: right; }

        .adm-dhikr-btn:hover:not(:disabled) {
            transform: translateY(-4px);
            border-bottom-width: 5px;
        }
        .adm-dhikr-btn:active:not(:disabled) {
            transform: translateY(-1px);
            border-bottom-width: 3px;
        }

        .adm-dhikr-btn:disabled {
            background: var(--adm-success-color);
            cursor: default;
            border-bottom-color: #1e7e34;
        }

        .adm-dhikr-btn .adm-counter {
            background-color: rgba(255, 255, 255, 0.2);
            padding: 0.2rem 0.8rem;
            border-radius: 50px;
            font-size: 0.9rem;
        }
        
        .adm-modal-footer {
            margin-top: auto;
            padding-top: clamp(0.8rem, 3vw, 1.2rem);
            border-top: 1px solid var(--adm-subtle-border);
        }
        
        .adm-dhikr-reminder .quran-verse {
            color: var(--adm-primary-text);
            font-weight: 700;
            font-family: 'Amiri Quran', serif;
            font-size: clamp(1.1rem, 4vw, 1.3rem);
            line-height: 2;
        }

        .adm-progress-bar-container {
            background-color: rgba(0, 123, 255, 0.1);
            border-radius: 50px;
            height: 10px;
            overflow: hidden;
        }
        #adm-progress-bar {
            width: 0%;
            height: 100%;
            background: var(--adm-success-color);
            border-radius: 50px;
            transition: width 0.6s ease-in-out;
        }
        
        .adm-jumaa-message-content {
            border-top-color: var(--adm-primary-accent-hover);
        }
        .adm-jumaa-message-content .closing-message {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            padding: clamp(0.8rem, 3.5vw, 1.1rem);
            border-radius: var(--adm-border-radius-md);
        }
        .adm-jumaa-message-content .closing-message p {
            color: #0c5460;
            font-weight: 700;
            margin: 0;
            font-size: clamp(1rem, 3.5vw, 1.1rem);
        }
        .isn-modal-content .quran-text {
            font-size: clamp(1.3rem, 4.5vw, 1.6rem);
            line-height: 1.8;
        }
        .isn-btn {
            font-family: 'Scheherazade New', serif;
            font-size: 1.2rem;
            padding: 0.8rem;
            border-radius: var(--adm-border-radius-md);
        }
    </style>
</head>
<body>

    <div id="adm-modal-overlay" class="adm-modal-overlay">
        
        <div id="adm-modal-content" class="adm-modal-content adm-hidden">
            <div class="adm-modal-header">
                <h2>أهلاً بكم في متجركم</h2>
                <p class="adm-tasks-header">للمتابعة، نرجو إنجاز هذه الأذكار اليسيرة.</p>
            </div>
            <div id="adm-dhikr-tasks" class="adm-dhikr-tasks" style="display: flex; flex-direction: column; gap: 1rem;">
                <button id="adm-btn-salat" class="adm-dhikr-btn">
                    <span class="adm-btn-text"><i class="fa-solid fa-moon adm-icon"></i>صلِّ على النبي ﷺ</span>
                    <span class="adm-counter">0/1</span>
                </button>
                <button id="adm-btn-tasbih" class="adm-dhikr-btn">
                    <span class="adm-btn-text"><i class="fa-solid fa-leaf adm-icon"></i>سبحان الله وبحمده</span>
                    <span class="adm-counter">0/1</span>
                </button>
                <button id="adm-btn-istighfar" class="adm-dhikr-btn">
                    <span class="adm-btn-text"><i class="fa-solid fa-hands-praying adm-icon"></i>استغفر الله</span>
                    <span class="adm-counter">0/1</span>
                </button>
            </div>
            <div class="adm-modal-footer">
                <div class="adm-dhikr-reminder">
                    <p class="quran-verse">﴿ أَلَا بِذِكْرِ اللَّهِ تَطْمَئِنُّ الْقُلُوبُ ﴾</p>
                </div>
                <div class="adm-progress-bar-container">
                    <div id="adm-progress-bar"></div>
                </div>
            </div>
        </div>

        <div id="adm-jumaa-message" class="adm-jumaa-message-content adm-hidden">
            <h2 class="jumaa-header">📿 تذكير بصلاة الجمعة</h2>
            <div class="jumaa-body" style="font-family: 'Amiri Quran', serif; font-size: 1.5rem; line-height: 2.2;">
                <p>يَٰٓأَيُّهَا ٱلَّذِينَ ءَامَنُوٓاْ إِذَا نُودِيَ لِلصَّلَوٰةِ مِن يَوۡمِ ٱلۡجُمُعَةِ فَٱسۡعَوۡاْ إِلَىٰ ذِكۡرِ ٱللَّهِ وَذَرُواْ ٱلۡبَيۡعَۚ</p>
            </div>
            <p class="jumaa-source">[سورة الجمعة: 9]</p>
            <button id="play-jumaa-audio" class="adm-dhikr-btn">
                <span class="adm-btn-text"><i class="fa-solid fa-volume-high adm-icon"></i> تشغيل التلاوة</span>
            </button>
            <div class="closing-message">
                <p>⛔ يغلق متجر <strong>S22MARKET</strong> أبوابه يوم الجمعة من <strong>11:30</strong> إلى <strong>14:00</strong>.</p>
            </div>
            <button class="adm-jumaa-refresh-btn isn-btn" aria-label="تحديث الصفحة" onclick="location.reload();">
                <span>اضغط هنا بعد الساعة 14:00</span>
            </button>
        </div>

        <div id="kahfModal" class="isn-modal-content jumaa-style adm-hidden">
            <div class="isn-modal-header"><h2>📿 فضل سورة الكهف</h2></div>
            <p class="quran-text">"من قرأ سورةَ الكهفِ في يومِ الجمعةِ أضاء له من النورِ ما بين الجمُعَتَين."</p>
            <p class="hadith-source">صحيح الترغيب | 736</p>
            <div class="buttons-container" style="display:flex; gap:1rem;">
                <a href="سورة الكهف مكتوبة.html" class="isn-btn" style="flex:1; background-color: var(--adm-primary-accent); color:white; text-decoration:none;">قراءة السورة</a>
                <button id="closeKahfModal" class="isn-btn" style="flex:1; background-color: #e9ecef; color:#495057; border:none; cursor:pointer;">إغلاق</button>
            </div>
        </div>
    </div>

    <audio id="jumaa-audio" src="JOMAA.mp3" preload="auto"></audio>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        try {
            const overlay = document.getElementById('adm-modal-overlay');
            const modals = {
                dhikr: document.getElementById('adm-modal-content'),
                jumaa: document.getElementById('adm-jumaa-message'),
                kahf: document.getElementById('kahfModal')
            };

            function handleWelcomeMessage() {
                const WELCOME_COOLDOWN = 6 * 60 * 60 * 1000; // 6 ساعات
                const lastShown = localStorage.getItem('welcomeMessageLastShown');
                const now = new Date().getTime();
                const header = modals.dhikr.querySelector('.adm-modal-header');

                if (header && (!lastShown || (now - lastShown > WELCOME_COOLDOWN))) {
                    const existingWelcomeEl = header.querySelector('.s22-welcome-msg');
                    if (existingWelcomeEl) return; 

                    const welcomeEl = document.createElement('p');
                    welcomeEl.className = 's22-welcome-msg';
                    welcomeEl.innerHTML = `🌟 مرحبا بكم في <strong>S22MARKET</strong>`;
                    welcomeEl.style.cssText = `
                        color: var(--adm-primary-accent-hover); font-weight: 700; margin-bottom: 1rem;
                        font-size: clamp(1.3rem, 5vw, 1.5rem); background-color: rgba(0, 123, 255, 0.08);
                        padding: 0.7rem; border-radius: var(--adm-border-radius-md);
                        border: 1px solid rgba(0, 123, 255, 0.1);`;
                    header.prepend(welcomeEl);
                    localStorage.setItem('welcomeMessageLastShown', now);
                }
            }
            
            // =========================================================================
            // [تعديل للمرة الثانية] هذا هو المنطق النهائي والصحيح
            // =========================================================================
            function handleModalsVisibility() {
                const now = new Date();
                const day = now.getDay(); // 5 = Friday
                const isFriday = (day === 5);

                Object.values(modals).forEach(modal => modal.classList.add('adm-hidden'));
                
                let modalToShow = null;

                if (isFriday) {
                    const currentTimeInMinutes = now.getHours() * 60 + now.getMinutes();
                    const isJumaaClosingTime = currentTimeInMinutes >= 690 && currentTimeInMinutes < 840; // 11:30 to 14:00
                    
                    if (isJumaaClosingTime) {
                        modalToShow = modals.jumaa;
                    } else {
                        // [تحسين] استخدام sessionStorage لمنع ظهورها عند كل تحديث في نفس الجلسة
                        const kahfShownThisSession = sessionStorage.getItem('kahfModalShown');
                        if (!kahfShownThisSession) {
                           modalToShow = modals.kahf;
                           sessionStorage.setItem('kahfModalShown', 'true');
                        }
                    }
                } else {
                    // هذا الكود يعمل فقط في الأيام غير الجمعة
                    const DHIKR_COOLDOWN = 2 * 60 * 60 * 1000; // ساعتان
                    const lastCompleted = localStorage.getItem('dhikrLastCompleted');
                    if (!lastCompleted || (now.getTime() - lastCompleted > DHIKR_COOLDOWN)) {
                        modalToShow = modals.dhikr;
                        handleWelcomeMessage();
                    }
                }

                if (modalToShow) {
                    modalToShow.classList.remove('adm-hidden');
                    overlay.classList.add('is-visible');
                }
            }
            
            handleModalsVisibility();

            // --- باقي السكربت للتحكم في الأزرار والصوت والأذكار (بدون تغيير) ---
            const jumaaAudio = document.getElementById('jumaa-audio');
            document.getElementById('play-jumaa-audio')?.addEventListener('click', (e) => {
                const btnText = e.currentTarget.querySelector('.adm-btn-text');
                if (jumaaAudio.paused) {
                    jumaaAudio.play();
                    btnText.innerHTML = '<i class="fa-solid fa-pause adm-icon"></i> جارٍ التشغيل...';
                } else {
                    jumaaAudio.pause();
                    btnText.innerHTML = '<i class="fa-solid fa-volume-high adm-icon"></i> تشغيل التلاوة';
                }
            });
            if(jumaaAudio) jumaaAudio.onended = () => {
                document.querySelector('#play-jumaa-audio .adm-btn-text').innerHTML = '<i class="fa-solid fa-volume-high adm-icon"></i> تشغيل التلاوة';
            };
            
            document.getElementById('closeKahfModal')?.addEventListener('click', () => {
                overlay.classList.remove('is-visible');
            });

            const dhikrModule = (() => {
                const dhikrModal = modals.dhikr;
                if (!dhikrModal) return;

                const buttons = Array.from(dhikrModal.querySelectorAll('.adm-dhikr-btn'));
                if (buttons.length === 0) return;

                const progressBar = document.getElementById('adm-progress-bar');
                const totalClicksRequired = buttons.length;
                let completedClicks = 0;

                const updateProgressBar = () => {
                    if (progressBar) {
                        progressBar.style.width = `${(completedClicks / totalClicksRequired) * 100}%`;
                    }
                };

                const onTaskComplete = () => {
                    localStorage.setItem('dhikrLastCompleted', new Date().getTime());
                    const tasksContainer = document.getElementById('adm-dhikr-tasks');
                    if(tasksContainer) {
                       tasksContainer.innerHTML = `<p style="color: var(--adm-success-color); font-size: 1.5rem; font-weight: bold;">جزاكم الله خيرًا!</p>`;
                    }
                    setTimeout(() => overlay.classList.remove('is-visible'), 2000);
                };

                buttons.forEach(btn => {
                    btn.addEventListener('click', () => {
                        if (btn.disabled) return;
                        
                        completedClicks++;
                        updateProgressBar();
                        btn.disabled = true;
                        
                        const textSpan = btn.querySelector('.adm-btn-text');
                        if (textSpan) {
                           textSpan.innerHTML = (textSpan.querySelector('.adm-icon')?.outerHTML || '') + 'أُنجِز';
                        }
                        const counterSpan = btn.querySelector('.adm-counter');
                        if (counterSpan) {
                            counterSpan.style.display = 'none';
                        }

                        if (completedClicks === totalClicksRequired) {
                            onTaskComplete();
                        }
                    }, { once: true });
                });
                updateProgressBar();
            })();

        } catch (error) {
            console.error("Script Error:", error);
            const overlay = document.getElementById('adm-modal-overlay');
            if (overlay) overlay.style.display = 'none';
        }
    });
    </script>

</body>
</html>